#include <Wire.h>//lcd 헤더 파일
#include <LiquidCrystal_I2C.h>//lcd 헤더 파일
#include <BigFont01_I2C.h>//lcd 헤더 파일
#include <SoftwareSerial.h>// 블루투스 헤더 파일
#include <OneWire.h>  // 온도센서 헤더 파일
#include <DallasTemperature.h>  // 온도센서 헤더 파일

int waterPin1 = A0;
int waterPin2 = A1;

#define ONE_WIRE_BUS 2

LiquidCrystal_I2C lcd(0x27, 20, 4); //아두이노 I2C (주소,넓이,높이) 설정
BigFont01_I2C     big(&lcd); //  폰트 설정

#define BT_TX_PIN 4  //블루투스 모듈 핀 설정 
#define BT_RX_PIN 5  //블루투스 모듈 핀 설정

//온도 센서 사용
OneWire oneWire(ONE_WIRE_BUS); // 온도 센서 사용
DallasTemperature sensors(&oneWire);  //온도 센서 사용
SoftwareSerial bluetooth(BT_TX_PIN, BT_RX_PIN);

void setup() {
  // put your setup code here, to run once:
  Serial.begin(9600);
  sensors.begin();
  bluetooth.begin(9600);
  lcd.init();
  lcd.backlight();
  big.begin();

  lcd.setCursor(13,0);
  lcd.print("o");
  lcd.setCursor(9,2);
  lcd.print(".");
  big.writechar(1,14,'c');

}

void loop() {
  // put your main code here, to run repeatedly:
  int value1 = analogRead(waterPin1);
  int value2 = analogRead(waterPin2);

  Serial.print("value1:");
  Serial.println(value1);
  Serial.print("value2:");
  Serial.println(value2);
  
  if(value1 < 700){
    Serial.println("1a");
    bluetooth.print("1a");
  }
  else{
    Serial.println("1a");
    bluetooth.print("1a");
  }
  
  delay(500);

//----------------------------------------------------------------------------------------------------

  sensors.requestTemperatures();  // 온도 가져오는 명령 전송 
  float temp1 = sensors.getTempCByIndex(0);  // 센서 온도 측정값을  temp1에 저장, 작은 물통(렌즈)
  float temp2 = sensors.getTempCByIndex(1);  // 센서 온도 측정값을 temp2에 저장
 
  float temp3 = sensors.getTempCByIndex(2);  //센서 온도 측정값을 temp3에 저장, 큰 물통
  float temp4 = sensors.getTempCByIndex(3);  //센서 온도 측정값을 temp4에 저장
  
  float tempDiff1 = temp1 - temp2;  // 작은 물통 온도 차이를 tempDiff1 변수에 저장
  float tempDiff2 = temp3 - temp4;  // 큰 물통 온도 차이를 tempDiff2 변수에 저장

//---------------------------------------------------------------------------------------------------

//LCD
  big.writeint(1,3,sensors.getTempCByIndex(0),2,false);
  int temp_f = sensors.getTempCByIndex(0)*10;
  big.writeint(1,10,temp_f,1,true);

  //작은 물통
  
  if(temp1 >= 60){            // 작은 물통 온도 60이상이면
    Serial.println("1b");
    bluetooth.print("1b");
  }
  else{
    Serial.println("0b"); 
    bluetooth.print("0b");  
  }

//작은 물통 
  if(water(tempDiff1) >= 3){ //두 온도의 차이가 3 이상이면 1c 출력
    Serial.println("1c");
    bluetooth.print("1c");
  }
  else{
    Serial.println("0c");  //두 개의 온도 차이가 3미만이면 0c 출력
    bluetooth.print("0c");  
  }
  
  //큰 물통 
  if(water(tempDiff2) >= 3){ //두 온도의 차이가 3 이상이면 1d 출력
    Serial.println("1d");
    bluetooth.print("1d");
  }
  else{
    Serial.println("0d");  //두 개의 온도 차이가 3미만이면 0d 출력
    bluetooth.print("0d");  
  }
  
  Serial.println(temp1);
  Serial.println(temp2);
  Serial.println(temp3);
  Serial.println(temp4);
  
   delay(100);
}
int water(int num) 
{
  
  if(num > 0){
    return num;
  }
  else{
    return -1 * num;
  }
}
